<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>TikTok Video Downloader - Baixe vídeos sem marca d'água</title>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background-color: #121212;
      color: #fff;
    }

    header {
      background-color: #000;
      color: #fff;
      text-align: center;
      padding: 1rem;
      font-size: 1.5rem;
      font-weight: 700;
      border-bottom: 1px solid #333;
    }

    main {
      padding: 2rem 1rem;
      max-width: 600px;
      margin: auto;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .input-with-icon {
      position: relative;
      display: flex;
      align-items: center;
    }

    .input-with-icon input {
      flex: 1;
      padding-right: 3rem;
    }

    .input-with-icon button {
      position: absolute;
      right: 0.75rem;
      background: none;
      border: none;
      color: #aaa;
      cursor: pointer;
      transition: color 0.2s, transform 0.2s;
      padding: 0;
    }

    .input-with-icon button:hover {
      color: #fff;
      transform: scale(1.1);
    }

    input[type="text"] {
      padding: 0.9rem 1rem;
      border-radius: 12px;
      border: none;
      background-color: #1e1e1e;
      color: #fff;
      font-size: 1rem;
      outline: none;
    }

    input[type="text"]::placeholder {
      color: #888;
    }

    button[type="submit"] {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background-color: #fe2c55;
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 0.9rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    button[type="submit"]:hover svg,
    .sheet-buttons button:hover svg {
      transform: scale(1.2) rotate(5deg);
    }

    #error {
      color: #ff4d4d;
      margin-top: 1rem;
    }

    #result {
      margin-top: 2rem;
      text-align: center;
    }

    #result img {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 1rem;
      border: 1px solid #333;
    }

    #downloadButton {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 1.5rem;
      padding: 0.8rem 1.5rem;
      background-color: #313131;
      color: #fff;
      border: none;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }

    #downloadButton:hover {
      background-color: #1E1E1E;
      color: #6C6C6C;
    }

    footer {
      text-align: center;
      padding: 2rem 1rem;
      font-size: 0.9rem;
      color: #777;
    }

    .hidden {
      display: none;
    }

    .bottom-sheet-overlay {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      top: 0;
      background-color: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: flex-end;
      z-index: 2000;
    }

    .bottom-sheet-overlay.hidden {
      display: none;
    }

    .bottom-sheet {
      background: #1e1e1e;
      color: #fff;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      padding: 20px;
      width: 100%;
      max-width: 480px;
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    .bottom-sheet h3 {
      font-size: 1.3rem;
      font-weight: 600;
    }

    .bottom-sheet p {
      font-size: 1rem;
      color: #ccc;
    }

    .sheet-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 1rem;
    }

    .sheet-buttons button {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    
    #videoTitleContainer {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 1rem;
      text-align: center;
    }

    #videoTitleShort {
      max-width: 100%;
      font-size: 1.2rem;
      font-weight: 600;
      word-break: break-word;
    }

    #watchAdBtn {
      background-color: #fe2c55;
      color: white;
    }

    #closeSheetBtn {
      background-color: #333;
      color: #fff;
    }

    @keyframes slideUp {
      from {
        transform: translateY(100%);
      }
      to {
        transform: translateY(0%);
      }
    }
  </style>
</head>
<body>
  <header>
    TikTok Video Downloader
  </header>
  <main>
    <form id="downloadForm" autocomplete="off" novalidate>
      <div class="input-with-icon">
        <input type="text" id="videoLink" placeholder="Cole o link do vídeo do TikTok" required />
        <button type="button" id="pasteBtn" aria-label="Colar">
          <i data-lucide="clipboard-paste"></i>
        </button>
      </div>
      <button type="submit">
        <i data-lucide="download"></i>
        Baixar sem Marca D'água
      </button>
    </form>
    <div id="error" class="hidden"></div>
    <div id="result" class="hidden">
      <div id="videoTitleContainer">
        <h2 id="videoTitleShort"></h2>
        <button id="toggleTitleBtn" aria-label="Expandir título" aria-expanded="false" style="background: none; border: none; color: #ccc; cursor: pointer;">
          <i data-lucide="chevron-down"></i>
        </button>
      </div>
      <img id="thumbnail" alt="Thumbnail do vídeo" />
      <a id="downloadButton" href="#" download>
        <i data-lucide="arrow-down-to-line"></i>
        Download
      </a>
    </div>
  </main>
  <footer>
    © 2025 TikTok Video Downloader. Todos os direitos reservados.
  </footer>

  <div id="bottomSheetOverlay" class="bottom-sheet-overlay hidden">
    <div class="bottom-sheet">
      <h3>Quase lá</h3>
      <p>Antes de continuar, você precisa ver um pequeno anúncio. É rapidinho e você nos ajuda a manter o site!</p>
      <div class="sheet-buttons">
        <button id="watchAdBtn">
          <i data-lucide="play-circle"></i>
          Ver anúncio
        </button>
        <button id="closeSheetBtn">
          <i data-lucide="x-circle"></i>
          Talvez depois
        </button>
      </div>
    </div>
  </div>

  <script>
    lucide.createIcons();

    (function () {
      const form = document.getElementById('downloadForm');
      const videoLinkInput = document.getElementById('videoLink');
      const errorDiv = document.getElementById('error');
      const resultDiv = document.getElementById('result');
      const thumbnailEl = document.getElementById('thumbnail');
      const downloadBtn = document.getElementById('downloadButton');
      const overlay = document.getElementById('bottomSheetOverlay');
      const watchAdBtn = document.getElementById('watchAdBtn');
      const closeSheetBtn = document.getElementById('closeSheetBtn');

      const pasteBtn = document.getElementById('pasteBtn');
      pasteBtn.addEventListener('click', async () => {
        try {
          const text = await navigator.clipboard.readText();
          videoLinkInput.value = text;
        } catch (err) {
          alert('Não foi possível acessar a área de transferência.');
        }
      });

      const tiktokRegex = /^(https?:\/\/)?(www\.)?(vm\.tiktok\.com|m\.tiktok\.com|tiktok\.com)\/.+$/i;

      downloadBtn.setAttribute('disabled', true);
      downloadBtn.style.opacity = '0.6';

      downloadBtn.addEventListener('click', function (e) {
        if (downloadBtn.hasAttribute('disabled')) {
          e.preventDefault();
          overlay.classList.remove('hidden');
        }
      });

      watchAdBtn.addEventListener('click', function () {
        overlay.classList.add('hidden');
        downloadBtn.removeAttribute('disabled');
        downloadBtn.style.opacity = '1';
        window.open("https://s.shopee.com.br/8007aI92bN", "_blank");
      });

      closeSheetBtn.addEventListener('click', function () {
        overlay.classList.add('hidden');
      });

      form.addEventListener('submit', async function (e) {
        e.preventDefault();
        errorDiv.textContent = '';
        errorDiv.classList.add('hidden');
        resultDiv.classList.add('hidden');

        const link = videoLinkInput.value.trim();
        if (!link || !tiktokRegex.test(link)) {
          errorDiv.textContent = 'Cole um link válido do TikTok.';
          errorDiv.classList.remove('hidden');
          return;
        }

        try {
          const response = await fetch(`https://tikwm.com/api/?url=${encodeURIComponent(link)}`);
          const result = await response.json();

          if (!result || result.code !== 0 || !result.data || !result.data.play || !result.data.cover) {
            throw new Error('Erro ao processar o vídeo.');
          }

          const fullTitle = result.data.title || 'Vídeo TikTok';
          const shortTitle = fullTitle.length > 25 ? fullTitle.slice(0, 25) + '...' : fullTitle;

          const titleShortEl = document.getElementById('videoTitleShort');
          const toggleBtn = document.getElementById('toggleTitleBtn');

          let isExpanded = false;

          toggleBtn.style.display = fullTitle.length > 25 ? 'inline-flex' : 'none';
          titleShortEl.textContent = shortTitle;

          toggleBtn.onclick = () => {
            isExpanded = !isExpanded;
            titleShortEl.textContent = isExpanded ? fullTitle : shortTitle;
            toggleBtn.setAttribute('aria-expanded', isExpanded);

            // Limpa o conteúdo do botão e adiciona o ícone correto
            toggleBtn.innerHTML = '';
            const icon = document.createElement('i');
            icon.setAttribute('data-lucide', isExpanded ? 'chevron-up' : 'chevron-down');
            toggleBtn.appendChild(icon);

            lucide.createIcons();
          };

          thumbnailEl.src = result.data.cover;
          thumbnailEl.alt = 'Thumbnail do vídeo';
          downloadBtn.href = result.data.play;
          resultDiv.classList.remove('hidden');
        } catch (err) {
          errorDiv.textContent = err.message || 'Erro ao buscar o vídeo.';
          errorDiv.classList.remove('hidden');
        }
      });
    })();
  </script>
</body>
</html>